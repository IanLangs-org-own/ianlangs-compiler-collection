#pragma once

#include <iostream>
#include <string>
#include <limits>
#include <tuple>
#include <typeinfo>
#include <type_traits>
#include <flow/types>
#include <flow/errors>
#if __cplusplus >= 202002L
#include <format>
#define __FLOW_HAS_FORMAT true
#else
#define __FLOW_HAS_FORMAT false
#endif
namespace flowBuffer {

    // ---------- utilidades internas (NO API) ----------


    template <typename T>
    inline void _print_one(const T& v) {
        std::cout << v;
    }

    template <typename T, typename... Ts>
    inline void _print_one(const T& v, const Ts&... rest) {
        std::cout << v;
        _print_one(rest...);
    }
}

namespace flow {
#if __FLOW_HAS_FORMAT
    template <typename... Ts>
    inline str format(const flow::str& fmt, Ts&&... args) {
        return str::fromCppStr(std::format(fmt, std::forward<Ts>(args)...));
    }

    template <typename... Ts>
    inline void printf(const flow::str& fmt, Ts&&... args) {
        flowBuffer::_print_one(::flow::format(fmt, std::forward<Ts>(args)...));
    }

    template <typename... Ts>
    inline void printlnf(const std::string& fmt, Ts&&... args) {
        flowBuffer::_print_one(::flow::format(fmt, std::forward<Ts>(args)...));
    }
#endif
    // ---------- print / println ----------

    template <typename... Ts>
    inline void print(const Ts&... args) {
        flowBuffer::_print_one(args...);
    }

    template <typename... Ts>
    inline void println(const Ts&... args) {
        flowBuffer::_print_one(args...);
        std::cout << '\n';
    }

    // ---------- input ----------

    inline void input(const std::string& ask, std::string& var) {
        print(ask);
        std::getline(std::cin, var);
    }

    inline void input(const std::string& ask, flow::str& var) {
        std::string buffer;
        print(ask);
        std::getline(std::cin, buffer);
        var = flow::str::fromCppStr(buffer);
    }

    template <typename T>
    inline void input(const std::string& ask, T& var) {
        print(ask);
        std::cin >> var;
        std::cin.ignore(std::numeric_limits<std::streamsize>::max(), '\n');
    }

    inline flow::str input(const std::string& ask) {
        print(ask);
        std::string buffer;
        std::getline(std::cin, buffer);
        return flow::str::fromCppStr(buffer);
    }
}
